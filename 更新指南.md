# StudyX Android APP 更新指南

## 📁 项目结构说明

```
StudyX-Android/
├── app/src/main/
│   ├── java/com/studyx/app/          # Java 原生代码（Android 功能）
│   │   ├── MainActivity.java         # 主活动 - WebView 容器
│   │   ├── WebAppInterface.java      # JS 与原生交互接口
│   │   └── UpdateManager.java        # 热更新管理器
│   ├── res/                          # 资源文件（图标、主题等）
│   └── assets/www/                   # Web 应用文件（网页代码）
│       ├── index.html                # 主页面
│       ├── styles.css                # 样式文件
│       ├── app.js                    # 主要逻辑
│       └── ...                       # 其他 JS/CSS/HTML 文件
└── build.gradle                      # 构建配置
```

---

## 🔄 两种更新方式

### 方式一：热更新（推荐网页修改）

**适用场景**：
- 修改界面样式（CSS）
- 修改页面逻辑（JS）
- 修改页面结构（HTML）
- 添加新功能模块
- 修复界面 bug

**优点**：
- ✅ 不需要重新安装 APK
- ✅ 用户自动获取更新
- ✅ 更新包体积小（几 MB）

**操作步骤**：
1. 修改 `StudyX-Android/app/src/main/assets/www/` 下的文件
2. 测试效果（刷新页面即可）
3. 运行 `make_update.bat` 生成更新包
4. 上传更新包到服务器
5. 用户打开 APP 自动下载更新

---

### 方式二：重新打包 APK（原生功能修改）

**适用场景**：
- 修改 Android 原生功能（Java 代码）
- 添加新的原生权限
- 修改应用图标/名称
- 升级 Gradle 或 SDK 版本
- 修改包名或签名

**缺点**：
- ❌ 需要重新安装 APK
- ❌ 需要重新分发安装包

**操作步骤**：
1. 修改 Java 代码或配置文件
2. 运行 `./gradlew.bat assembleDebug` 打包
3. 分发新的 APK 文件

---

## 💡 什么配置需要保留？

### ✅ 已完成的配置（已保存，无需重复设置）

这些修改都已保存在代码文件中，**不会丢失**：

| 配置项 | 所在文件 | 说明 |
|--------|----------|------|
| 权限配置 | `AndroidManifest.xml` | 已移除过度权限 |
| Gradle 配置 | `build.gradle`, `gradle-wrapper.properties` | 已适配 Java 21 |
| 中文路径支持 | `gradle.properties` | 已添加 `overridePathCheck` |
| TTS 语音功能 | `WebAppInterface.java` | 已添加原生语音支持 |
| 手机端 UI 适配 | `styles.css` (媒体查询) | 已添加移动端样式 |
| 底部导航 | `index.html`, `app.js` | 已配置手机端导航 |

### 🔄 每次更新可能需要调整的

**热更新时（修改网页）**：
- 如果修改了 CSS，要确保手机端样式正常
- 如果添加了新页面，要在底部导航添加入口

**重新打包时**：
- 如果升级 Android Studio，可能需要重新配置 JDK 路径
- 如果修改了包名，需要重新配置签名

---

## 🚀 推荐的开发流程

### 日常更新（网页修改）

```bash
# 1. 修改网页文件
#    - 编辑 StudyX-Android/app/src/main/assets/www/ 下的文件

# 2. 本地测试（两种方式）
#    方式 A：直接在电脑浏览器打开 index.html 测试
#    方式 B：在 Android Studio 中运行 APP 测试

# 3. 生成热更新包
cd StudyX-Android
make_update.bat

# 4. 上传更新
#    - 将生成的 updates/studyx_vX.X.X.zip 上传到服务器
#    - 更新 updates/update.json 版本信息
```

### 重大更新（原生功能修改）

```bash
# 1. 修改 Java 代码或配置

# 2. 重新打包
cd StudyX-Android
./gradlew.bat assembleRelease

# 3. 签名（如果是发布版）
#    使用 build_signed.bat

# 4. 分发 APK
```

---

## 📦 备份建议

**重要**：建议备份以下文件，以便快速恢复环境：

1. `local.properties` - SDK 路径配置
2. `gradle.properties` - Gradle 配置
3. `app/build.gradle` - 应用构建设置
4. `WebAppInterface.java` - 原生功能接口

这些文件我都已经帮你配置好了，建议用 Git 或手动备份一份。

---

## ❓ 常见问题

**Q: 我换了电脑，需要重新配置吗？**
A: 需要重新配置：
   - 安装 Android Studio
   - 配置 `local.properties` 中的 SDK 路径
   - 其他配置都在代码里，直接拷贝项目即可

**Q: 我只想改个按钮颜色，需要重新打包吗？**
A: 不需要！直接修改 CSS，然后热更新即可。

**Q: 我想添加拍照功能，需要重新打包吗？**
A: 需要！拍照是原生功能，需要修改 Java 代码并重新打包。

---

**总结**：现在的配置都已保存，后续更新只需要根据需要选择热更新或重新打包即可。
